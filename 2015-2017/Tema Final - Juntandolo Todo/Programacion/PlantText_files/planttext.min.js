function toggleVisibles(){0==editor.getShowInvisibles()?editor.setShowInvisibles(!0):editor.setShowInvisibles(!1)}function toggleIndentGuide(){0==editor.getDisplayIndentGuides()?editor.setDisplayIndentGuides(!0):editor.setDisplayIndentGuides(!1)}function ptq(e){var t,o,n,a=e.replace(/;/g,"&").split("&");for(e={},t=0;t<a.length;t++)n=a[t].split("=",2),o=unescape(n[0]),e[o]||(e[o]=[]),n.length>1?e[o][e[o].length]=unescape(n[1]):e[o][e[o].length]=!0;return e}function param(){return ptq(location.search.substring(1).replace(/\+/g," "))}function entify(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/>/g,"&gt;")}function refreshFromButton(){var e=document.getElementById("description").value;"undefined"!=typeof Storage&&localStorage.setItem("plantuml_diagram",e),compress(e),$("#fademessage").css("color","black").css("background-color","white").html("The diagram is refreshing and your PlantUML has been saved to your computer's local storage.").fadeIn(1).fadeOut(5e3)}function defaultFromButton(){document.getElementById("plantumlserver").value="http://www.plantuml.com/plantuml/",$("#fademessage").css("color","black").css("background-color","white").html("The PlantUML server is now set to ... '"+document.getElementById("plantumlserver").value+"'.").fadeIn(1).fadeOut(5e3)}function codeFromButton(){var e=document.getElementById("language").value,t=document.getElementById("description").value;$.ajax({type:"POST",url:"http://plant2code.planttext.com:8888/",timeout:5e3,data:{language:""+e,plantuml:""+t}}).done(function(e){document.getElementById("codeoutput").value=e}),$("#fademessage").css("color","black").css("background-color","white").html("Converting PlantUML to code stubs.").fadeIn(1).fadeOut(5e3)}function saveFromButton(){var e=document.getElementById("description").value,t=document.getElementById("theme").value,o=document.getElementById("keybinding").value,n=document.getElementById("fontsize").value,a=document.getElementById("invisibles").checked,i=document.getElementById("indentguide").checked,d=document.getElementById("plantumlserver").value;"undefined"!=typeof Storage&&localStorage.setItem("plantuml_diagram",e),compress(e),$.ajax({type:"POST",url:"save",timeout:5e3,data:{diagram:""+e,theme:""+t,keybinding:""+o,fontsize:""+n,invisibles:""+a,indentguide:""+i,plantumlserver:""+d}}),$("#fademessage").css("color","black").css("background-color","white").html("Your PlantUML and settings have been saved to the PlantText server. You can load them now from any computer.").fadeIn(1).fadeOut(5e3)}function loadFromButton(){var e=confirm('This will replace the PlantUML in your editor window with what has been saved previously to the server. Press "Ok" to coninue or "Cancel" to abort.',"Load");1==e&&($.ajax({type:"POST",url:"load",timeout:5e3}).done(function(e){refreshFromSamples(e)}),$("#fademessage").css("color","black").css("background-color","white").html("Your PlantUML has been loaded from the PlantText server.").fadeIn(1).fadeOut(5e3))}function refreshFromSamples(e){editor.getSession().setValue(e),compress(document.getElementById("description").value),resizeEditor()}function resizeBrowser(){$("#sidebar").height($(window).height()-sidebar_portrait_h_mod),resizeEditor()}function resizeEditor(){$("#editor").width($("#sidebar").width()-10),$("#editor").height($("#sidebar").height()-65),editor.resize()}function openHelp(){$("#help").dialog({width:500}),$("#help").dialog("open")}function openSettings(){$("#setting").dialog({width:500}),$("#setting").dialog("open")}function openCode(){$("#code").dialog({width:500}),$("#code").dialog("open")}function openFiles(){$("#files").dialog({width:500}),$("#files").dialog("open")}function openServer(){$("#servers").dialog({width:500}),$("#servers").dialog("open")}function unDock(){var e=$(window).width()-($("#sidebar").width()+50);$("#sidebar").draggable(),$("#sidebar").css({top:10}),$("#sidebar").css({left:+e}),$("#content").offset(sidebar_offset),resizeEditor(),$("#fademessage").css("color","black").css("background-color","white").html("The editor is now in drag mode. You can move it around to any position on the screen.").fadeIn(1).fadeOut(5e3)}function doDock(){$("#sidebar").draggable("destroy"),$("#sidebar").width(sidebar_portrait_w),$("#sidebar").height($(window).height()-sidebar_portrait_h_mod),$("#sidebar").offset(sidebar_offset),$("#sidebar").css({"float":"left"}),resizeEditor(),$("#content").css({"float":"left"}),$("#content").offset(diagram_offset),$("#fademessage").css("color","black").css("background-color","white").html("The editor is now in dock mode. It will always be docked to the upper left and the diagram will to the right or below it.").fadeIn(1).fadeOut(5e3)}function portrait(){$("#sidebar").height($(window).height()-sidebar_portrait_h_mod),$("#sidebar").width(sidebar_portrait_w),resizeEditor()}function landscape(){$("#sidebar").height($(window).height()/sidebar_landscape_h_mod),$("#sidebar").width($(window).width()-sidebar_landscape_w_mod),resizeEditor()}function importUML(){var e=document.getElementById("fileInput"),t=e.files[0],o=/text.*/;if(t.type.match(o)){var n=new FileReader;n.onload=function(e){editor.getSession().setValue(n.result),compress(document.getElementById("description").value)},n.readAsText(t),resizeEditor()}else alert("File not supported!");return!1}function exportUML(){return Download.save(editor.getSession().getValue(),"plantuml_export.txt"),!1}function repositionTooltip(e,t){$("#sidebar").css("opacity",t.value)}var sidebar_portrait_w=500,sidebar_portrait_h_mod=180,sidebar_landscape_w_mod=45,sidebar_landscape_h_mod=2,sidebar_offset={top:101,left:13},diagram_offset={top:101,left:535},warn_about_samples=!0,has_saved_diagram=!1,editor=ace.edit("editor"),textarea=$('textarea[name="description"]').hide();editor.getSession().setValue(textarea.val()),editor.getSession().on("change",function(){textarea.val(editor.getSession().getValue())}),document.getElementById("theme").onchange=function(){var e=this.options[this.selectedIndex].value;editor.setTheme("ace/theme/"+e)},document.getElementById("fontsize").onchange=function(){var e=this.options[this.selectedIndex].value;editor.setFontSize(e),editor.resize()},document.getElementById("keybinding").onchange=function(){var e=this.options[this.selectedIndex].value;editor.setKeyboardHandler("ace/keyboard/"+e)},document.getElementById("samples").onchange=function(){var e=this.options[this.selectedIndex].value;"default"!=e&&$.ajax({url:"diagram?diagram="+e,success:function(e){if(warn_about_samples){var t=confirm('This will replace the PlantUML you have in your editor window. Press "Ok" to coninue or "Cancel" to abort.',"Samples");1==t&&(refreshFromSamples(e),warn_about_samples=!1)}else refreshFromSamples(e)}})};var Download={click:function(e){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",!0,!1,self,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)},encode:function(e){return"data:application/octet-stream;base64,"+btoa(e)},link:function(e,t){var o=document.createElement("a");return o.download=t||self.location.pathname.slice(self.location.pathname.lastIndexOf("/")+1),o.href=e||self.location.href,o}};Download.save=function(e,t){this.click(this.link(this.encode(e),t))},$(window).resize(resizeBrowser),resizeBrowser(),$(document).keydown(function(e){13==e.keyCode&&e.altKey&&$("#refreshbutton").click()}),$(document).ready(function(){$("#sidebar").resizable({resize:function(e,t){resizeEditor()},minHeight:350,minWidth:290}),$("#help").dialog({autoOpen:!1,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}),$("#setting").dialog({autoOpen:!1,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}),$("#code").dialog({autoOpen:!1,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}),$("#files").dialog({autoOpen:!1,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}),$("#servers").dialog({autoOpen:!1,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}});var e=!1,t="";q=param();for(k in q)"text"==entify(k)&&(e=!0,t=entify(q[k][0]));if(e){var o=decode64(t);refreshFromSamples(o)}else if("undefined"!=typeof Storage&&!has_saved_diagram){var n=localStorage.getItem("plantuml_diagram");null!=n&&editor.getSession().setValue(localStorage.getItem("plantuml_diagram"))}compress(document.getElementById("description").value)});
